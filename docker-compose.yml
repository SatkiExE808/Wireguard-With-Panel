version: "3.8"

services:
  wg-easy:
    image: ghcr.io/wg-easy/wg-easy:latest
    container_name: wg-easy
    environment:
      # Required: Your server's public IP or domain
      - WG_HOST=${WG_HOST}

      # Required: Password for the web UI
      - PASSWORD=${PASSWORD}

      # Optional: WireGuard VPN port (default: 51820)
      - WG_PORT=${WG_PORT:-51820}

      # Optional: DNS servers for VPN clients (default: Cloudflare DNS)
      - WG_DEFAULT_DNS=${WG_DEFAULT_DNS:-1.1.1.1, 1.0.0.1}

      # Optional: Allowed IPs for routing (default: all traffic through VPN)
      - WG_ALLOWED_IPS=${WG_ALLOWED_IPS:-0.0.0.0/0, ::/0}

      # Optional: Persistent keepalive for clients behind NAT (default: 25 seconds)
      - WG_PERSISTENT_KEEPALIVE=${WG_PERSISTENT_KEEPALIVE:-25}

      # Optional: Default VPN subnet address (default: 10.8.0.x)
      - WG_DEFAULT_ADDRESS=${WG_DEFAULT_ADDRESS:-10.8.0.x}

      # Optional: MTU for WireGuard interface (default: 1420)
      - WG_MTU=${WG_MTU:-1420}

      # Optional: Pre and post up/down scripts
      # - WG_PRE_UP=
      # - WG_POST_UP=
      # - WG_PRE_DOWN=
      # - WG_POST_DOWN=

    volumes:
      # Persist WireGuard configuration
      - ./wg-easy:/etc/wireguard

    ports:
      # WireGuard VPN port (UDP)
      - "${WG_PORT:-51820}:51820/udp"

      # Web UI port (TCP)
      - "${WG_UI_PORT:-51821}:51821/tcp"

    restart: unless-stopped

    cap_add:
      # Required capabilities for WireGuard
      - NET_ADMIN
      - SYS_MODULE

    sysctls:
      # Required kernel parameters
      - net.ipv4.conf.all.src_valid_mark=1
      - net.ipv4.ip_forward=1
